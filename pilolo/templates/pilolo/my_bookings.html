{% extends 'base.html' %}

{% block title %}My Bookings - Pilolo Tours{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 py-8 px-4 sm:px-6 lg:px-8">
  <div class="max-w-4xl mx-auto">
    <!-- Modern Header with Tabs -->
    <div class="mb-8">
      <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
        <h1 class="text-2xl sm:text-3xl font-bold text-gray-900">
          <span class="inline-block mr-2">üö¥‚Äç‚ôÇÔ∏è</span>
          My Bookings
        </h1>
        <a href="{% url 'home' %}" class="flex items-center text-sm font-medium text-ghana-green hover:text-green-700">
          <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
          </svg>
          New Tour
        </a>
      </div>

      <!-- Tabs with JS for active state and HTMX for requests -->
      <div class="border-b border-gray-200 overflow-x-auto scrollbar-hide">
        <nav class="flex space-x-8 min-w-max" id="bookings-tabs">
          <a href="{% url 'my_bookings' %}?status=all" 
             data-status="all"
             class="tab-button {% if current_status == 'all' %}active{% endif %} py-3 sm:py-4 px-1 border-b-2 font-medium text-sm flex items-center whitespace-nowrap">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
            All Bookings
          </a>
          <a href="{% url 'my_bookings' %}?status=upcoming" 
             data-status="upcoming"
             class="tab-button {% if current_status == 'upcoming' %}active{% endif %} py-3 sm:py-4 px-1 border-b-2 font-medium text-sm flex items-center whitespace-nowrap">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
            </svg>
            Upcoming
          </a>
          <a href="{% url 'my_bookings' %}?status=completed" 
             data-status="completed"
             class="tab-button {% if current_status == 'completed' %}active{% endif %} py-3 sm:py-4 px-1 border-b-2 font-medium text-sm flex items-center whitespace-nowrap">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
            Completed
          </a>
          <a href="{% url 'my_bookings' %}?status=cancelled" 
             data-status="cancelled"
             class="tab-button {% if current_status == 'cancelled' %}active{% endif %} py-3 sm:py-4 px-1 border-b-2 font-medium text-sm flex items-center whitespace-nowrap">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
            Cancelled
          </a>
        </nav>
      </div>
    </div>

    <!-- Loading Indicator -->
    

    <!-- Content Area -->
    <div id="bookings-content">
      <div id="loading-indicator" class="justify-center my-8 hidden transition-opacity duration-300 h-64">
        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"></div>
      </div>
      {% include 'pilolo/partials/_bookings_list.html' %}
    </div>
  </div>
</div>



<script>
document.addEventListener('DOMContentLoaded', function() {
  const tabs = document.querySelectorAll('#bookings-tabs .tab-button');
  const contentContainer = document.getElementById('bookings-content');
  const loadingIndicator = document.getElementById('loading-indicator');
  
  // Initialize HTMX
  htmx.config.useTemplateFragments = true;
  
  // Tab click handler
  tabs.forEach(tab => {
    tab.addEventListener('click', function(e) {
      e.preventDefault();
      
      // Update active tab
      tabs.forEach(t => t.classList.remove('active'));
      this.classList.add('active');
      
      // Show loading indicator
      loadingIndicator.classList.remove('hidden');
      loadingIndicator.classList.add('flex');


      // Get the URL from the clicked tab
      const url = this.getAttribute('href');
      
      // Make HTMX request
      htmx.ajax('GET', url, {
        target: '#bookings-content',
        swap: 'innerHTML',
        onSuccess: function() {
          // Hide loading indicator
          loadingIndicator.classList.add('hidden');
          loadingIndicator.classList.remove('flex');

          // Update URL without full page reload
          window.history.pushState({}, '', url);
        },
        onError: function() {
          // Hide loading indicator on error too
          loadingIndicator.classList.remove('hidden');
          loadingIndicator.classList.add('flex');
        }
      });
    });
  });
  
  // Handle browser back/forward
  window.addEventListener('popstate', function() {
    const url = window.location.href;
    htmx.ajax('GET', url, {
      target: '#bookings-content',
      swap: 'innerHTML'
    });
    
    // Update active tab based on URL
    const params = new URLSearchParams(window.location.search);
    const status = params.get('status') || 'all';
    tabs.forEach(t => t.classList.remove('active'));
    document.querySelector(`.tab-button[data-status="${status}"]`).classList.add('active');
  });
});
</script>

<style>
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }
  
  .tab-button {
    color: #6b7280;
    border-color: transparent;
    transition: all 0.2s ease;
  }
  .tab-button:hover {
    color: #374151;
    border-color: #d1d5db;
  }
  .tab-button.active {
    color: #047857;
    border-color: #047857;
  }
</style>
{% endblock %}